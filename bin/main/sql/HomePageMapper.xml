<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="home">

	<!-- 메인화면에 보여줄 레시피 리스트 출력 -->
	<select id="recipe_home" resultType="wh.user.home.model.HomePageRecipeDto">
		select * from recipe_info natural join members limit 5
	</select>
	
	<!-- 재료로 레시피 검색 -->
	<select id="searchFromIngre" resultType="wh.user.home.model.HomePageRecipeDto" parameterType="int">
		select * 
		from recipe_info natural join members 
		where recipe_id in (
					select *
                    from
                    	<foreach collection="array" item="ingre" index="i" separator="natural join">
                    	(
                    		SELECT recipe_id
							FROM ingredient natural join recipe_ingre
							where ing_id = #{ingre}
                        ) as r#{i} 
                    	</foreach>
                    	group by r0.recipe_id

                    )
	</select>
	
	<!-- 이름으로 레시피 검색 -->
	<select id="searchFromName" parameterType="string" resultType="wh.user.home.model.HomePageRecipeDto">
		select * from recipe_info natural join members where recipe_name like CONCAT('%',#{recipe_Name},'%')
	</select>
	
	<!-- 냉장고를 부탁해 소분류 리스트 출력 -->
	<select id="nangbuList" parameterType="int" resultType="wh.user.home.model.HomePageNangbuDto">
		select * from ingredient where ing_category = #{ing_category}
	</select>
	
	<!-- 냉장고를 부탁해 대분류 리스트 출력 -->
	<select id="nangbuCategoryList" resultType="map">
		select ing_category,category_name from ingredient group by(ing_category)
	</select>
	
	<!-- 카테고리 리스트 출력 -->
	<select id="categoryName" resultType="wh.user.home.model.HomePageCategoryName">
		select * from category
	</select>
	
	<!-- 카테고리로 레시피 검색 -->
	<select id="searchFromCategory" resultType="wh.user.home.model.HomePageRecipeDto" parameterType="int">
		select * 
		from recipe_info natural join members 
		where recipe_id in (
					select *
                    from
                    	<foreach collection="array" item="id" index="i" separator="natural join">
                    	(
						SELECT recipe_id
						FROM recipe_category natural join category
						where category_id = #{id}
						) as r#{i}
                    	</foreach>
                    	group by r0.recipe_id

                    )
	</select>
	
	<!-- 홈페이지 카테고리별 추천 -->
	<select id="recommandRecipe" resultType="wh.user.home.model.HomePageRecipeDto" parameterType="int">
		select * from recipe_info natural join recipe_category natural join category natural join members where category_id = #{category_id} limit 5;
	</select>
	
	<!-- 카테고리 이름 출력 -->
	<select id="recommandName" resultType="string" parameterType="int">
		select category_name from category where category_id = #{category_id}
	</select>

</mapper>